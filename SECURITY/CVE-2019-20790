CVE-2019-20790 - OpenDMARC through 1.3.2 and 1.4.x, when used with 
pypolicyd-spf 2.0.2, allows attacks that bypass SPF and DMARC 
authentication in situations where the HELO field is inconsistent 
with the MAIL FROM field.

Link: https://nvd.nist.gov/vuln/detail/CVE-2019-20790

Details: While the SPF RFC (RFC 7208) says that entities MUST check 
the envelope sender during an SPF check (Section 2.4), Section 2.3 also
says that checking the HELO/EHLO string is RECOMMENDED.  

It further states (Section 2.3): 

    If a conclusive determination about the message can be made based on 
    a check of "HELO", then the use of DNS resources to process the typically 
    more complex "MAIL FROM" can be avoided.

The HELO string is trivially forgeable and can be set to any value by 
anyone delivering mail to a system.  It does not depend on the hostname 
of the transmitting system.  There is no guarantee that the HELO value
will be validated by the receiving system.  Moreover, RFC 5321 (the
current SMTP specification) says:

    An SMTP server MAY verify that the domain name argument in the EHLO
    command actually corresponds to the IP address of the client.
    However, if the verification fails, the server MUST NOT refuse to
    accept a message on that basis. 

Resolution/Workaround: It is the job of OpenDMARC to trust information 
provided to it by upstream filters.  OpenDMARC itself can be configured 
to validate SPF, but there are use cases where OpenDMARC may be running 
further inside a network and not have access to the connection strings as 
logged.  No standard exists for relaying the IP address of the client
to inward systems when relaying occurs.

It is the view of the OpenDMARC developers that this is working as 
designed, but if this behavior is undesirable, then any filter that adds 
a Received-SPF header field should not set a spf=pass result based solely on
the HELO/EHLO string.  It is not the job of OpenDMARC to second-guess other 
filters in the chain, but simply to compare their stated values and make 
a weight-based judgement.
